'use client';import { useState } from 'react';import WalletBar from './components/WalletBar';import { sha256Hex } from './components/hash';import { Transaction, TransactionButton, TransactionStatus, TransactionStatusAction, TransactionStatusLabel } from '@coinbase/onchainkit/transaction';import { base, baseSepolia } from 'viem/chains';const CHAIN_ID=Number(process.env.NEXT_PUBLIC_CHAIN_ID||84532);const chainId=CHAIN_ID===8453?base.id:baseSepolia.id;export default function Page(){const [title,setTitle]=useState('My Accomplishment');const [proofText,setProofText]=useState('');const [file,setFile]=useState(null as any);const [imagePreview,setImagePreview]=useState(null as any);const [metadataURI,setMetadataURI]=useState(null as any);const onFile=(e:any)=>{const f=e.target.files?.[0];setFile(f||null);if(f){const r=new FileReader();r.onload=()=>setImagePreview(r.result as string);r.readAsDataURL(f);}else{setImagePreview(null);}};const prepareMetadata=async()=>{let proofHash='';if(file){const buf=await file.arrayBuffer();proofHash=await sha256Hex(buf);}else if(proofText.trim().length>0){proofHash=await sha256Hex(proofText.trim());}else{throw new Error('Provide a file or proof text.');}const res=await fetch('/api/ipfs',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({title,proofHash,imageBase64:imagePreview||null})});if(!res.ok){throw new Error(await res.text());}const data=await res.json();setMetadataURI(data.metadataURI);return data.metadataURI as string;};const calls=async()=>{const uri=metadataURI||await prepareMetadata();const res=await fetch('/api/tx',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({uri})});if(!res.ok){throw new Error(await res.text());}const data=await res.json();return data.calls;};return(<main className='container'><div className='row' style={{justifyContent:'space-between'}}><div><span className='badge'>Base â€¢ Gasless</span><h1 className='title'>ProofMint</h1><p className='subtitle'>Mint verifiable NFTs of your accomplishments.</p></div><WalletBar/></div><div className='grid'><div className='card'><h3>1) Add your proof</h3><div style={{display:'grid',gap:10}}><input className='input' value={title} onChange={e=>setTitle(e.target.value)} placeholder='Title (e.g., Minecraft Any% 12:34)'/><textarea className='textarea' value={proofText} onChange={e=>setProofText(e.target.value)} placeholder='Optional: paste proof string / replay hash / URL. Or upload a file below.' rows={5}/><input className='file' type='file' accept='image/*,video/*,.txt,.json' onChange={onFile}/>{imagePreview&&<img className='preview' src={imagePreview} alt='preview'/>}<div className='muted'>We compute a SHA-256 of your proof file or text and include it on-chain for verification.</div></div></div><div className='card'><h3>2) Mint (gasless)</h3><div className='row'><Transaction isSponsored chainId={chainId} calls={calls}><TransactionButton className='button' text='Mint Your Proof NFT'/><TransactionStatus><TransactionStatusLabel/><TransactionStatusAction/></TransactionStatus></Transaction></div><div style={{height:10}}/><div className='muted'>A Paymaster covers your gas. After minting, view your NFT in your wallet or on a Base explorer.</div></div></div></main>);}
